<ion-header class="ion-no-border">
    @if (searchBarVisible) {
        <ion-toolbar class="ion-padding ion-no-border">
            <ion-searchbar class="ion-no-border custom" [(ngModel)]="categoryService.searchCategory"
                           (ionInput)="categoryService.filterCategories()"
                           (ionCancel)="toggleSearch()"
                           placeholder="nach Kategorie suchen"
                           show-cancel-button="always"
                           show-clear-button="focus"
            ></ion-searchbar>
        </ion-toolbar>
    } @else {
        <ion-toolbar>
            <ion-title class="ion-padding-top">Favoriten</ion-title>
            <ion-buttons slot="start">
                <ion-button class="button-solid ion-padding-top" [routerLink]="['/home']">
                    <ion-icon name="arrow-back-outline" class="arrowBack"></ion-icon>
                </ion-button>
            </ion-buttons>
            @if (categoryService.categories) {
                <ion-buttons slot="end">
                    <ion-button (click)="toggleSearch()">
                        <ion-icon  name="search-outline"></ion-icon>
                    </ion-button>
                </ion-buttons>
            }
        </ion-toolbar>
    }
</ion-header>

<ion-content class="ion-padding">
    <div class="Module">
        <ion-grid>
            <ion-row class="header-row-m">
                <ion-col size="auto">
                    <ion-text class="entdecken">Favoriten</ion-text>
                </ion-col>
            </ion-row>

            <ion-list class="favoriteItem" *ngIf="favCategories.length > 0">
                <ion-item-sliding *ngFor="let category of favCategories">
                    <ion-item lines="none">
                        <ion-grid>
                            <ion-row class="ion-align-items-center">
                                <ion-col class="centerCircle" size="2">
                                    <svg class="progressCircle" width="30" height="30"
                                         viewBox="0 0 50 50">
                                        <circle class="progressCircleBack" cx="25" cy="25" r="20"
                                                fill="none" stroke="#eee" stroke-width="5"/>
                                        <circle class="progressCircleFront" cx="25" cy="25" r="20"
                                                fill="none" stroke="#ff6f61" stroke-width="5"
                                                [attr.stroke-dasharray]="125.6"
                                                [attr.stroke-dashoffset]="125.6 - (category.completedCards / category.questionCount * 125.6)"/>
                                    </svg>
                                </ion-col>
                                <ion-col size="6" (click)="categoryService.startQuiz(category.id)">
                                    {{ category.name }}
                                </ion-col>
                                <ion-col size="4" class="ion-text-right">
                                    {{ category.completedCards }} / {{ category.questionCount }}
                                </ion-col>
                            </ion-row>
                        </ion-grid>
                    </ion-item>
                    <ion-item-options side="end">
                        <ion-item-option color="danger" (click)="removeFav(category)">
                            <ion-icon slot="icon-only" name="trash"></ion-icon>
                        </ion-item-option>
                    </ion-item-options>
                </ion-item-sliding>
            </ion-list>


            <ion-list class="favoriteItem" *ngIf="favCategories.length === 0">
                <ion-item lines="none">
                    <ion-text>Du hast noch keine Favoriten ðŸ˜¢
                    </ion-text>
                </ion-item>
            </ion-list>
        </ion-grid>
    </div>




    <div class="ion-margin-top">
        <ion-grid *ngIf="categoryService.completedCategories.length > 0">
            <ion-row class="header-row-m">
                <ion-col size="auto">
                    <ion-text class="entdecken">Absolviert</ion-text>
                </ion-col>
            </ion-row>
            <ion-list class="categories">
                <ion-item-sliding *ngFor="let category of categoryService.completedCategories">
                    <ion-item lines="none" [disabled]="true">
                        <ion-grid>
                            <ion-row class="ion-align-items-center">
                                <ion-col size="6">
                                    {{ category.name }}
                                </ion-col>
                            </ion-row>
                        </ion-grid>
                    </ion-item>
                </ion-item-sliding>
            </ion-list>
        </ion-grid>
    </div>

    <div class="ion-margin-top" *ngIf="categoryService.pendingCategories.length > 0">
        <ion-grid>
            <ion-row class="header-row-m">
                <ion-col size="auto">
                    <ion-text class="entdecken">Entdecken</ion-text>
                </ion-col>
            </ion-row>
            <ion-list class="categories">
                <ion-item-sliding *ngFor="let category of categoryService.pendingCategories">
                    <ion-item lines="none" (click)="addFav(category.id, category.name, category.questionCount)">
                        <ion-grid>
                            <ion-row class="ion-align-items-center">
                                <ion-col size="6">
                                    {{ category.name }}
                                </ion-col>
                            </ion-row>
                        </ion-grid>
                    </ion-item>
                    <ion-item-options side="end">
                    </ion-item-options>
                </ion-item-sliding>
            </ion-list>
        </ion-grid>
    </div>
</ion-content>


